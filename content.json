{"meta":{"title":"肥皂味的格子衫","subtitle":"一路跋涉，一路找寻","description":"随记,Note","author":"SmallLoop","url":"https://smallloop.github.io","root":"/"},"pages":[{"title":"archives","date":"2024-12-02T05:39:01.000Z","updated":"2024-12-02T05:47:13.100Z","comments":true,"path":"archives/index.html","permalink":"https://smallloop.github.io/archives/index.html","excerpt":"","text":""},{"title":"所有分类","date":"2024-12-02T05:46:54.563Z","updated":"2024-12-02T05:46:54.563Z","comments":true,"path":"categories/index.html","permalink":"https://smallloop.github.io/categories/index.html","excerpt":"","text":""},{"title":"所有标签","date":"2024-12-02T05:46:36.947Z","updated":"2024-12-02T05:46:36.947Z","comments":true,"path":"tags/index.html","permalink":"https://smallloop.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"记一次哪吒监控agent安装","slug":"nezha-agent","date":"2025-08-19T00:54:36.000Z","updated":"2025-08-19T07:30:03.286Z","comments":true,"path":"2025/08/19/nezha-agent/","permalink":"https://smallloop.github.io/2025/08/19/nezha-agent/","excerpt":"","text":"背景 国内Nat机器(简称A)，面板搭建在国外服务器，Nat机器(A)商家屏蔽了国外出口，基于上述原因所以需要通过另一台国内可以访问面板机的机器(简称B)借助gost进行端口转发 步骤1.在国内能够访问面板机的机器B上安装gost，并执行以下命令 12./gost -L tcp://:18008/data.nezha.com:8008# data.nezha.com:8008为面板机通信域名+端口，18008为B机器接收A机器数据的内网端口 效果图: 2.下载agent上传至A机器&#x2F;opt&#x2F;nezha目录并修改Nat机器上agent的conf.yml文件,主要修改server信息 12345678910111213141516171819client_secret: ZGRcE3Sas4BlBVEKwmOD2KLJACgQQEQ9debug: falsedisable_auto_update: truedisable_command_execute: truedisable_force_update: falsedisable_nat: truedisable_send_query: falsegpu: falseinsecure_tls: falseip_report_period: 1800report_delay: 3server: 213.224.27.84:10196 #修改此处通信的IP地址和端口为上面gost服务B机器的IP地址和端口，如果B服务器是Nat机器可能要进行端口映射，须填写映射端口，比如18008映射10196skip_connection_count: falseskip_procs_count: falsetemperature: falsetls: falseuse_gitee_to_upgrade: falseuse_ipv6_country_code: falseuuid: 26f94cce-ws70-23bf-5725-29f6932322999 3.启动agent 12cd /opt/nezha./nezha-agent -c ./config.yml restart gost成功显示接收信息效果图: B机器后台运行gost123nohup ./gost -L tcp://:18008/data.nezha.com:8008 &gt; gost.log 2&gt;&amp;1 &amp;# 查看日志tail -f gost.log","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"NeZha","slug":"NeZha","permalink":"https://smallloop.github.io/tags/NeZha/"}],"author":"SmallLoop"},{"title":"Docker命令","slug":"docker-cmd","date":"2025-08-15T06:34:17.000Z","updated":"2025-08-15T08:32:42.345Z","comments":true,"path":"2025/08/15/docker-cmd/","permalink":"https://smallloop.github.io/2025/08/15/docker-cmd/","excerpt":"","text":"查看所有的容器1docker ps -a 启动某个容器1docker run -itd --name danmuAPI -p 9000:9000 danmu 运行参数-i: 以交互模式运行容器，通常与 -t 同时使用 -t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用 -d: 后台运行容器，并返回容器ID -p: 指定端口映射，格式为：主机(宿主)端口:容器端口 查看 Docker 的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息1docker inspect 容器ID 列出镜像1docker images 删除容器1docker rm -rf 容器ID 删除镜像1docker rmi 镜像ID 进入容器1docker exec -it 容器ID bash 将容器中的相应文件copy到刚创建的管理目录中，PS:bde9da482585为nginx容器ID12docker cp bde9da482585:/etc/nginx/nginx.conf /data/nginx/docker cp bde9da482585:/etc/nginx/conf.d /data/nginx/conf/ 修改容器运行端口1/var/lib/docker/containers/容器ID/hostconfig.json","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://smallloop.github.io/tags/Docker/"}],"author":"SmallLoop"},{"title":"自签名证书","slug":"ssl-private","date":"2025-08-15T06:17:51.000Z","updated":"2025-08-15T06:28:27.007Z","comments":true,"path":"2025/08/15/ssl-private/","permalink":"https://smallloop.github.io/2025/08/15/ssl-private/","excerpt":"","text":"生成证书： Debian系统：123openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes \\ -keyout server.key -out server.crt -subj &quot;/CN=1.2.3.4&quot; \\ -addext &quot;subjectAltName=IP:1.2.3.4&quot; Windows系统(可能需要单独安装openssl)：1openssl req -x509 -newkey rsa:4096 -days 3650 -nodes -keyout server.key -out server.crt -subj &quot;/CN=1.2.3.4&quot; -addext &quot;subjectAltName=IP:1.2.3.4&quot; Nginx配置 替换 1.2.3.4 为你的IP地址：1234567891011121314151617181920server &#123; listen 443 ssl; listen [::]:443 ssl; server_name 1.2.3.4; ssl_certificate_key /root/server.key; #key路径 ssl_certificate /root/server.crt; #crt路径 ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / &#123; proxy_pass http://127.0.0.1:8090; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;Upgrade&quot;; &#125; &#125;","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://smallloop.github.io/tags/SSL/"},{"name":"证书","slug":"证书","permalink":"https://smallloop.github.io/tags/%E8%AF%81%E4%B9%A6/"}],"author":"SmallLoop"},{"title":"Docker安装","slug":"docker-install","date":"2025-07-22T06:14:51.000Z","updated":"2025-07-22T06:26:00.655Z","comments":true,"path":"2025/07/22/docker-install/","permalink":"https://smallloop.github.io/2025/07/22/docker-install/","excerpt":"","text":"本文以阿里云镜像x86_64 debian系统为例：1.安装必要的一些系统工具12sudo apt-get updatesudo apt-get install ca-certificates curl gnupg 2.信任 Docker 的 GPG 公钥12sudo install -m 0755 -d /etc/apt/keyringscurl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg 3.写入软件源信息1234echo \\ &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/debian \\ &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \\ sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null 4.安装Docker12sudo apt-get updatesudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin 具体可参考:https://developer.aliyun.com/mirror/docker-ce国外服务器可以尝试一键脚本安装:1curl -fsSL https://get.docker.com | bash -s docker 修改镜像源12345678sudo nano /etc/docker/daemon.json#添加镜像地址&#123; &quot;registry-mirrors&quot;: [&quot;https://xxxxxxxx.mirror.aliyuncs.com&quot;]&#125;#重载daemon并重启Dockersudo systemctl daemon-reloadsudo systemctl restart docker","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://smallloop.github.io/tags/Docker/"}],"author":"SmallLoop"},{"title":"Nginx示例","slug":"nginx-example","date":"2025-01-13T02:16:17.000Z","updated":"2025-07-22T06:26:07.442Z","comments":true,"path":"2025/01/13/nginx-example/","permalink":"https://smallloop.github.io/2025/01/13/nginx-example/","excerpt":"","text":"Nginx反代http简单示例1234567891011121314151617181920server &#123; listen 80; listen [::]:80; server_name www.example.com; return 301 https://www.example.com$request_uri;&#125;server &#123; listen 443 ssl; listen [::]:443 ssl; server_name www.example.com; ssl_certificate /etc/nginx/cert/example.pem; ssl_certificate_key /etc/nginx/cert/nav.key; location / &#123; proxy_pass http://127.0.0.1:8080; proxy_set_header Host $http_host; proxy_set_header Upgrade $http_upgrade; &#125; &#125; Nginx反代Cloudflare Work社区相关解答:https://community.cloudflare.com/t/access-cloudflare-workers-with-nginx-proxy/478073/3123456789101112131415161718192021server &#123; listen 80; listen [::]:80; server_name www.example.com; return 301 https://www.example.com$request_uri;&#125;server &#123; listen 443 ssl; listen [::]:443 ssl; server_name www.example.com; ssl_certificate /etc/nginx/cert/example.pem; ssl_certificate_key /etc/nginx/cert/example.key; location / &#123; proxy_pass https://nav.example.workers.dev; #移除所有默认 proxy 配置 #proxy_set_header Host $http_host; #proxy_set_header Upgrade $http_upgrade; proxy_ssl_server_name on; &#125;&#125;","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://smallloop.github.io/tags/Nginx/"}],"author":"SmallLoop"},{"title":"SSH登录","slug":"sshlogin","date":"2024-12-23T08:38:28.000Z","updated":"2025-07-22T06:26:19.941Z","comments":true,"path":"2024/12/23/sshlogin/","permalink":"https://smallloop.github.io/2024/12/23/sshlogin/","excerpt":"","text":"生成公钥和密钥1ssh-keygen 复制公钥到服务器1ssh-copy-id username(用户名)@your_server_ip(服务器IP) 连接SSH1ssh username@your_server_ip","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"SSH","slug":"SSH","permalink":"https://smallloop.github.io/tags/SSH/"}],"author":"SmallLoop"},{"title":"SSL证书安装","slug":"ssl","date":"2024-12-23T08:09:51.000Z","updated":"2025-07-22T06:26:24.982Z","comments":true,"path":"2024/12/23/ssl/","permalink":"https://smallloop.github.io/2024/12/23/ssl/","excerpt":"","text":"安装证书工具：1curl https://get.acme.sh | sh; apt install socat -y || yum install socat -y; ~/.acme.sh/acme.sh --set-default-ca --server letsencrypt 三种方式任选其中一种，申请失败则更换方式 申请证书方式1： IPv4:1~/.acme.sh/acme.sh --issue -d 域名 --standalone -k ec-256 --force --insecure IPV6:1~/.acme.sh/acme.sh --issue -d 域名 --standalone -k ec-256 --force --insecure --listen-v6 --debug 申请证书方式2：1~/.acme.sh/acme.sh --register-account -m &quot;$&#123;RANDOM&#125;@chacuo.net&quot; --server buypass --force --insecure &amp;&amp; ~/.acme.sh/acme.sh --issue -d 域名 --standalone -k ec-256 --force --insecure --server buypass 申请证书方式3：1~/.acme.sh/acme.sh --register-account -m &quot;$&#123;RANDOM&#125;@chacuo.net&quot; --server zerossl --force --insecure &amp;&amp; ~/.acme.sh/acme.sh --issue -d 域名 --standalone -k ec-256 --force --insecure --server zerossl 安装证书：1~/.acme.sh/acme.sh --install-cert -d 域名 --ecc --key-file /etc/x-ui/server.key --fullchain-file /etc/x-ui/server.crt CentOS错误:提示：curl: (60) The certificate issuer’s certificate has expired. Check your system date and time.解决如下：123rpm -q ca-certificatesrpm -q ca-certificates --changelog | headyum -y update ca-certificates","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://smallloop.github.io/tags/SSL/"},{"name":"证书","slug":"证书","permalink":"https://smallloop.github.io/tags/%E8%AF%81%E4%B9%A6/"}],"author":"SmallLoop"},{"title":"Nginx安装","slug":"nginx","date":"2024-12-02T10:06:13.000Z","updated":"2025-07-22T06:26:13.310Z","comments":true,"path":"2024/12/02/nginx/","permalink":"https://smallloop.github.io/2024/12/02/nginx/","excerpt":"","text":"首先安装编译工具及相关依赖库1sudo apt install make gcc libpcre3 libpcre3-dev zlib1g-dev libssl-dev 下载最新nginx源代码编译1234567891011121314151617wget https://nginx.org/download/nginx-1.26.2.tar.gztar -zxvf nginx-1.26.2.tar.gzmv nginx-1.26.2 nginxcd nginx./configure --with-stream \\ --with-stream_ssl_module \\ --with-stream_ssl_preread_module \\ --with-stream=dynamic \\ --with-http_ssl_module \\ --with-http_ssl_module \\ --with-http_v2_module \\ --with-http_v3_module \\ --with-http_gunzip_module \\ --with-http_gzip_static_module \\ --with-http_sub_modulemakemake install 配置服务123456789101112131415nano /etc/systemd/system/nginx.service# 添加以下内容[Unit]Description=The NGINX HTTP and reverse proxy serverAfter=network.target remote-fs.target nss-lookup.target[Service]Type=forkingPIDFile=/usr/local/nginx/logs/nginx.pidExecStart=/usr/local/nginx/sbin/nginxExecReload=/usr/local/nginx/sbin/nginx -s reloadExecStop=/usr/local/nginx/sbin/nginx -s stopPrivateTmp=true[Install]WantedBy=multi-user.target 重新加载服务1sudo systemctl daemon-reload 配置开机自启1sudo systemctl enable nginx Docker安装方式(自定义文件挂载路径)Docker安装：curl -fsSL https://get.docker.com | bash -s docker123456docker run --name nginx \\ -itd --network=host \\ -p 80:80 -p 443:443 \\ -v /root/nginx-data/conf:/etc/nginx/conf.d \\ -v /root/nginx-data/cert:/etc/nginx/cert \\ -d --restart=always nginx","categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://smallloop.github.io/tags/Nginx/"}],"author":"SmallLoop"}],"categories":[{"name":"随笔","slug":"随笔","permalink":"https://smallloop.github.io/categories/%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"NeZha","slug":"NeZha","permalink":"https://smallloop.github.io/tags/NeZha/"},{"name":"Docker","slug":"Docker","permalink":"https://smallloop.github.io/tags/Docker/"},{"name":"SSL","slug":"SSL","permalink":"https://smallloop.github.io/tags/SSL/"},{"name":"证书","slug":"证书","permalink":"https://smallloop.github.io/tags/%E8%AF%81%E4%B9%A6/"},{"name":"Nginx","slug":"Nginx","permalink":"https://smallloop.github.io/tags/Nginx/"},{"name":"SSH","slug":"SSH","permalink":"https://smallloop.github.io/tags/SSH/"}]}